<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Estimasi Konstruksi Terpadu</title>
    
    <link rel="stylesheet" href="style_base.css">
    <link rel="stylesheet" href="style_layout.css">
    <link rel="stylesheet" href="style_components.css">
    
    <style>
        /* Fallback CSS jika file eksternal gagal muat */
        .sidebar { position: fixed; left: 0; top: 0; height: 100%; width: 200px; background: #2c3e50; padding-top: 20px; z-index: 1000; }
        .nav-btn { display: block; width: 90%; margin: 10px auto; padding: 12px; border: none; background: #34495e; color: white; text-align: left; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .nav-btn.active { background: #3498db; }
        .nav-btn:hover { background: #3e5871; }
        .app-container { margin-left: 220px; padding: 20px; }
        /* Layout Canvas */
        .canvas-wrapper { text-align: center; background: white; padding: 20px; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .controls-denah { background: #f1f2f6; padding: 15px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd; }
        @media print { .sidebar, .no-print { display: none !important; } .app-container { margin-left: 0; } }
    </style>
</head>
<body>

    <div class="sidebar no-print">
        <button onclick="showPage('home')" class="nav-btn active" id="btn-nav-home">ğŸ  Home (RAB)</button>
        <button onclick="showPage('denah')" class="nav-btn" id="btn-nav-denah">ğŸ“ Denah 2D</button>
    </div>

    <div class="app-container">
        
        <div id="page-home" class="page-section">
            <div class="app-header">
                <h1>Estimasi Konstruksi Terpadu</h1>
                <div class="header-total no-print" id="txt-grandtotal-top">Rp 0</div>
            </div>

            <div class="controls">
                <div class="grid-inputs" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div class="input-wrap">
                        <label>ğŸ¢ Tipe Bangunan</label>
                        <select id="inp_type" onchange="calculateAuto()">
                            <option value="default">Standar Hunian</option>
                        </select>
                    </div>
                    <div class="input-wrap">
                        <label>ğŸ“ Luas Bangunan (mÂ²)</label>
                        <input type="number" id="inp_LB" value="36" oninput="calculateAuto()">
                    </div>
                    <div class="input-wrap">
                        <label>ğŸ—ºï¸ Luas Tanah (mÂ²)</label>
                        <input type="number" id="inp_LT" value="60" oninput="calculateAuto()">
                    </div>
                    <div class="input-wrap">
                        <label>ğŸ“¶ Jumlah Lantai</label>
                        <input type="number" id="inp_floors" value="1" oninput="calculateAuto()">
                    </div>
                    <div class="input-wrap">
                        <label>ğŸšœ Kondisi Tanah</label>
                        <select id="inp_soil" onchange="calculateAuto()">
                            <option value="normal">Tanah Stabil (Normal)</option>
                            <option value="soft">Tanah Lunak</option>
                            <option value="peat">Gambut</option>
                        </select>
                    </div>
                    <div class="input-wrap">
                        <label>ğŸ—ï¸ Metode Pelaksanaan</label>
                        <select id="inp_execution_mode" onchange="calculateAuto()">
                            <option value="borongan_hemat">Borongan Hemat</option>
                            <option value="kontraktor_pro" selected>Kontraktor Pro</option>
                        </select>
                    </div>
                    <div class="input-wrap">
                        <label>ğŸ›ï¸ Kelas Struktur</label>
                        <select id="inp_structure_grade" onchange="calculateAuto()">
                            <option value="light">Ekonomis</option>
                            <option value="std" selected>Standar (SNI)</option>
                            <option value="heavy">Heavy Duty</option>
                        </select>
                    </div>
                    <div class="input-wrap">
                        <label>ğŸ’° Target Budget</label>
                        <input type="number" id="inp_target_budget" placeholder="0" oninput="calculateAuto()">
                    </div>
                </div>

                <div class="custom-entry" style="margin-top: 20px; padding: 15px; border: 1px dashed #ccc; background: #fdfdfd; border-radius: 8px;">
                    <h4>â• Tambah Pekerjaan Manual</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <input type="text" id="cust_name" placeholder="Nama Item" style="flex: 2;">
                        <input type="number" id="cust_vol" placeholder="Vol" style="width: 60px;">
                        <input type="text" id="cust_sat" placeholder="Sat" style="width: 60px;">
                        <input type="number" id="cust_price" placeholder="Harga" style="flex: 1;">
                        <button onclick="addCustomItem()" style="background: #27ae60; color: white; border: none; padding: 5px 15px; cursor: pointer;">Tambah</button>
                    </div>
                </div>

                <div class="btn-group no-print" style="margin-top: 20px;">
                    <button id="btn-calc" onclick="calculateAuto()" disabled>ğŸ”„ RE-KALKULASI</button>
                    <button onclick="exportToCSV()">ğŸ“„ Export CSV</button>
                    <button onclick="window.print()">ğŸ–¨ï¸ Print PDF</button>
                </div>
            </div>

            <div id="result-area" class="table-responsive" style="margin-top:20px;">
                <table id="rab-table" style="width:100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background:#ecf0f1;">
                            <th>Aksi</th><th>Kode</th><th>Uraian</th><th>Vol</th><th>Sat</th><th>Harga</th><th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
            
            <div class="footer-summary" style="margin-top:20px; text-align:right;">
                <h3>GRAND TOTAL: <span id="txt-grandtotal">Rp 0</span></h3>
                <div id="budget-alert-box" style="display:none; padding:10px; margin-top:10px;"></div>
            </div>
        </div>

        <div id="page-denah" class="page-section" style="display:none;">
            <div class="app-header">
                <h1>ğŸ“ Smart Architect (Grid 100m)</h1>
            </div>

            <div class="controls-denah">
                <h4>â• Tambah Ruangan Manual</h4>
                <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                    <input type="text" id="inp_room_name" placeholder="Nama Ruang" style="width:120px;">
                    <select id="inp_room_type">
                        <option value="bedroom">Kamar Tidur</option>
                        <option value="wc">WC/Toilet</option>
                        <option value="living">R. Tamu</option>
                        <option value="kitchen">Dapur</option>
                        <option value="garden">Taman</option>
                    </select>
                    <input type="number" id="inp_room_w" value="3" placeholder="P" style="width:50px;">
                    <input type="number" id="inp_room_h" value="3" placeholder="L" style="width:50px;">
                    <button onclick="addRoomManual()" style="background:#2980b9; color:white; border:none; padding:8px 15px; cursor:pointer;">+ Tambah</button>
                    <button onclick="optimizeLayout()" style="background:#27ae60; color:white; border:none; padding:8px 15px; cursor:pointer;">âš¡ Auto-Layout</button>
                </div>
            </div>

            <div class="canvas-wrapper">
                <canvas id="canvas2d" width="800" height="500" style="border: 1px solid #bdc3c7; background: #fdfdfd; cursor: grab;"></canvas>
                <div id="denah-info-panel" style="margin-top:10px;"></div>
            </div>
        </div>

    </div>

    <script>
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(el => el.style.display = 'none');
            document.getElementById('page-' + pageId).style.display = 'block';
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-nav-' + pageId).classList.add('active');
            
            // Redraw canvas saat pindah tab agar tidak glitch
            if(pageId === 'denah' && window.Engine_Architect) {
                setTimeout(() => window.Engine_Architect.draw(), 100);
            }
        }
    </script>

    <script src="config.js"></script>
    <script src="init.js"></script>

    <script src="core_models.js"></script>
    <script src="engine_calc.js"></script>
    <script src="engine_architect.js"></script>
    <script src="engine_furniture.js"></script>
    
    <script src="ui_renderer.js"></script>
    <script src="app_controller.js"></script>

</body>
</html>
