<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Estimasi Konstruksi Terpadu</title>
    
    <link rel="stylesheet" href="https://gist.githack.com/freddyhutauruk18-cpu/af8779059c0470794be08d1bd6cb4abc/raw/style_base.css">
    <link rel="stylesheet" href="https://gist.githack.com/freddyhutauruk18-cpu/af8779059c0470794be08d1bd6cb4abc/raw/style_layout.css">
    <link rel="stylesheet" href="https://gist.githack.com/freddyhutauruk18-cpu/af8779059c0470794be08d1bd6cb4abc/raw/style_components.css">

    <style>
        /* Sidebar Navigation Style */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            width: 200px;
            background: #2c3e50;
            padding-top: 20px;
            z-index: 1000;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            transition: width 0.3s;
        }
        
        .nav-btn {
            display: block;
            width: 90%;
            margin: 10px auto;
            padding: 12px 15px;
            border: none;
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.8);
            text-align: left;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
        }
        
        .nav-btn.active {
            background: #3498db;
            color: white;
            font-weight: 700;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .nav-btn:hover:not(.active) {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        /* Layout Adjustment for Sidebar */
        .app-container {
            margin-left: 220px; /* Memberi ruang untuk sidebar */
            padding: 20px;
            max-width: calc(100% - 260px); /* Agar tidak melebar ke kanan */
        }
        
        /* Page Sections */
        .page-section {
            display: none; /* Default hidden, JS will show one */
            animation: fadeIn 0.4s ease;
        }
        
        /* Print Mode Adjustment */
        @media print {
            .sidebar, .no-print { display: none !important; }
            .app-container { margin: 0; padding: 0; max-width: 100%; }
            .page-section { display: block !important; } /* Tampilkan semua saat print? Atau hanya yang aktif */
            #page-denah { display: block; break-before: page; } /* Cetak denah di halaman baru */
        }

        @media (max-width: 768px) {
            .sidebar { width: 60px; }
            .nav-btn { text-align: center; padding: 15px 5px; font-size: 10px; }
            .app-container { margin-left: 70px; max-width: calc(100% - 80px); }
        }
    </style>
</head>
<body>

    <div class="sidebar no-print">
        <div style="text-align: center; margin-bottom: 20px; color: white; font-weight: bold; font-size: 1.2em;">
            APP PRO
        </div>
        <button onclick="showPage('home')" class="nav-btn active" id="btn-nav-home">üè† Home (RAB)</button>
        <button onclick="showPage('denah')" class="nav-btn" id="btn-nav-denah">üìê Denah 2D</button>
    </div>

    <div class="app-container">
        
        <div id="page-home" class="page-section" style="display: block;">
            <div class="app-header">
                <h1>Estimasi Konstruksi Terpadu</h1>
                <div class="header-total no-print" id="txt-grandtotal-top">Rp 0</div>
            </div>

            <div id="system-status" class="status-init">‚è≥ Menghubungkan Database...</div>

            <div class="controls">
                <div class="grid-inputs">
                    <div class="input-wrap">
                        <label>üè¢ Tipe Bangunan</label>
                        <select id="inp_type" onchange="calculateAuto()">
                            <option>Memuat tipe...</option>
                        </select>
                    </div>

                    <div class="input-wrap">
                        <label>üìè Luas Bangunan (m¬≤)</label>
                        <input type="number" id="inp_LB" value="45" oninput="calculateAuto()">
                    </div>
                    <div class="input-wrap">
                        <label>üó∫Ô∏è Luas Tanah (m¬≤)</label>
                        <input type="number" id="inp_LT" value="72" oninput="calculateAuto()">
                    </div>
                    <div class="input-wrap">
                        <label>üì∂ Jumlah Lantai</label>
                        <input type="number" id="inp_floors" value="1" oninput="calculateAuto()">
                    </div>

                    <div class="input-wrap">
                        <label>üöú Kondisi Tanah</label>
                        <select id="inp_soil" onchange="calculateAuto()">
                            <option value="normal">Tanah Stabil (Normal)</option>
                            <option value="soft">Tanah Lunak/Sawah</option>
                            <option value="peat">Tanah Rawa/Gambut</option>
                        </select>
                    </div>

                    <div class="input-wrap" style="border: 1px solid #fab1a0; padding: 5px; border-radius: 5px; background: #fff5f2;">
                        <label style="color: #d35400;">üèóÔ∏è Metode Pelaksanaan</label>
                        <select id="inp_execution_mode" onchange="calculateAuto()">
                            <option value="borongan_hemat" selected>üõ†Ô∏è Borongan Hemat</option>
                            <option value="mandor_standar">üë∑ Mandor/Pemborong</option>
                            <option value="kontraktor_pro">üè¢ Kontraktor Pro</option>
                        </select>
                    </div>

                    <div class="input-wrap" style="border: 1px solid #2980b9; padding: 5px; border-radius: 5px; background: #ebf5fb;">
                        <label style="color: #1a5276;">üèõÔ∏è Kelas Struktur</label>
                        <select id="inp_structure_grade" onchange="calculateAuto()">
                            <option value="light">Ekonomis (Light)</option>
                            <option value="std" selected>Standar (SNI)</option>
                            <option value="heavy">Heavy Duty (Siap Dak)</option>
                        </select>
                    </div>

                    <div class="input-wrap">
                        <label>üí∞ Target Budget (Opsional)</label>
                        <input type="number" id="inp_target_budget" placeholder="Cth: 200000000" oninput="checkBudget()">
                    </div>
                </div>

                <div class="custom-entry" style="margin-top: 20px; padding: 15px; border: 1px dashed #ccc; background: #fdfdfd; border-radius: 8px;">
                    <h4>‚ûï Tambah Pekerjaan Kustom (Ketik Bebas)</h4>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <input type="text" id="cust_name" placeholder="Nama Pekerjaan (Contoh: Pasang Lampu Hias)" style="flex: 2; padding: 8px;" class="inp-table">
                        <input type="number" id="cust_vol" placeholder="Vol" style="width: 60px; padding: 8px;" class="inp-table">
                        <input type="text" id="cust_sat" placeholder="Sat" style="width: 60px; padding: 8px;" class="inp-table">
                        <input type="number" id="cust_price" placeholder="Harga Satuan" style="flex: 1; padding: 8px;" class="inp-table">
                        <button onclick="addCustomItem()" class="btn" style="background: #27ae60; color: white; cursor: pointer;">Tambah Ke RAB</button>
                    </div>
                </div>

                <div class="btn-group no-print">
                    <button id="btn-calc" class="btn btn-calc" onclick="calculateAuto()" disabled>üîÑ RE-KALKULASI</button>
                    <button class="btn btn-export" onclick="exportToCSV()">üìÑ Export CSV</button>
                    <button class="btn btn-pdf" onclick="window.print()">üñ®Ô∏è Simpan PDF</button>
                </div>
            </div>

            <div id="budget-alert-box" class="budget-alert no-print" style="display:none;"></div>

            <div id="result-area" class="table-responsive">
                <table id="rab-table">
                    <thead>
                        <tr>
                            <th style="width: 80px;" class="no-print">Aksi</th>
                            <th style="width: 80px;">Kode</th>
                            <th>Uraian Pekerjaan</th>
                            <th class="text-center" style="width: 80px;">Vol</th>
                            <th class="text-center" style="width: 60px;">Sat</th>
                            <th class="text-right" style="width: 120px;">Harga Sat</th>
                            <th class="text-right" style="width: 140px;">Total</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        </tbody>
                </table>
            </div>
            
            <div class="footer-summary">
                <div class="summary-box">
                    <div style="text-align: right;">
                        <div>Subtotal Teknis</div>
                        <div>Jasa & Safety (Est)</div>
                        <div style="font-size: 0.9rem; margin-top:5px; font-weight:bold;">GRAND TOTAL ESTIMASI</div>
                    </div>
                    <div style="text-align: right;">
                        <div id="txt-subtotal" class="font-mono">Rp 0</div>
                        <div id="txt-jasa" class="font-mono">Rp 0</div>
                        <div id="txt-grandtotal" class="grand-total font-mono">Rp 0</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-denah" class="page-section">
            <div class="app-header">
                <h1>üìê Smart Architect (Grid System)</h1>
                <p style="margin:0; font-size:0.9rem; opacity:0.8;">Desain Layout Ruangan & Furniture Drag-and-Drop</p>
            </div>

            <div class="controls-denah" style="background:#f8f9fa; padding:15px; margin-bottom:15px; border-radius:8px; border:1px solid #e9ecef;">
                <h4 style="margin-top:0; color:#2c3e50;">‚ûï Tambah Ruangan Manual</h4>
                <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:end;">
                    <div class="input-group">
                        <label style="font-size:12px; display:block;">Nama Ruangan</label>
                        <input type="text" id="inp_room_name" placeholder="Cth: K. Tidur Anak" class="inp-table" style="width:150px; padding:8px;">
                    </div>
                    <div class="input-group">
                        <label style="font-size:12px; display:block;">Tipe</label>
                        <select id="inp_room_type" class="inp-table" style="padding:8px;">
                            <option value="bedroom">Kamar Tidur</option>
                            <option value="wc">Kamar Mandi/WC</option>
                            <option value="living">R. Tamu/Keluarga</option>
                            <option value="kitchen">Dapur</option>
                            <option value="garden">Taman</option>
                            <option value="general">Lainnya</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label style="font-size:12px; display:block;">Panjang (m)</label>
                        <input type="number" id="inp_room_w" value="3" style="width:60px; padding:8px;" class="inp-table">
                    </div>
                    <div class="input-group">
                        <label style="font-size:12px; display:block;">Lebar (m)</label>
                        <input type="number" id="inp_room_h" value="3" style="width:60px; padding:8px;" class="inp-table">
                    </div>
                    <button onclick="addRoomManual()" class="btn" style="background:#2980b9; color:white; height:38px; border:none; padding:0 15px; border-radius:4px; cursor:pointer;">+ Tambah</button>
                    <button onclick="optimizeLayout()" class="btn" style="background:#27ae60; color:white; height:38px; border:none; padding:0 15px; border-radius:4px; cursor:pointer;">‚ö° Auto-Layout</button>
                </div>
            </div>

            <div class="canvas-wrapper" style="text-align: center; background: white; padding: 20px; border-radius: 8px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.05);">
                <canvas id="canvas2d" width="800" height="600" style="border: 1px solid #bdc3c7; background: #fdfdfd; cursor: grab; max-width:100%;"></canvas>
                
                <div id="denah-info-panel" style="margin-top:15px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
                    </div>
                <div style="margin-top:5px; font-size:0.8rem; color:#95a5a6; font-style:italic;">
                    Klik & Drag untuk memindahkan ruangan atau furniture.
                </div>
            </div>
        </div>

    </div>

    <div id="searchModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle">Tambah Item Pekerjaan</h3>
            <input type="text" id="searchBox" placeholder="Ketik nama pekerjaan..." style="width:100%; padding:10px; margin-bottom:15px; box-sizing:border-box;" autofocus>
            <div id="searchResults"></div>
        </div>
    </div>

    <script>
        function showPage(pageId) {
            // Sembunyikan semua section
            document.querySelectorAll('.page-section').forEach(section => {
                section.style.display = 'none';
            });
            // Tampilkan section yang dipilih
            document.getElementById('page-' + pageId).style.display = 'block';
            
            // Update status button sidebar
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('btn-nav-' + pageId).classList.add('active');

            // Jika pindah ke denah, paksa render ulang canvas agar ukurannya pas
            if(pageId === 'denah' && window.Engine_Architect) {
                window.Engine_Architect.draw();
            }
        }
    </script>

    <script src="https://gist.githack.com/freddyhutauruk18-cpu/d0830ea482df60ce5448ab7ea0827b0e/raw/config.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/28a260f3494571941261071bb9abd200/raw/init.js"></script>
    
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/d0f7a8ba351fd5a2f2d9928fdf410f0d/raw/types_housing.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/dc390646584fdb032df986340894a168/raw/types_business.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/6b58b9e728bfa1bfbd3a5cadc16800f0/raw/types_industrial.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/c301bb36f2a8c11dc830cd230387bf2d/raw/types_special.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/building_types.js"></script> <script src="https://gist.githack.com/freddyhutauruk18-cpu/0ade848f99da02d39d4a3ae953a6bff8/raw/engine.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/1170e61e1b879d912173d16c47b75120/raw/ui_renderer.js"></script>
    
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/app_search.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/app_controller.js"></script>
    <script src="https://gist.githack.com/freddyhutauruk18-cpu/app_init.js"></script>

</body>
</html>